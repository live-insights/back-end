# Live Insights üìä 

Bem-vindo ao Live Insights WebApi!
Aqui, voc√™ vai avaliar a performance da sua live no YouTube de forma pr√°tica.
Vamos come√ßar?

---

## üì¶ **Depend√™ncias**

Antes de rodar o projeto, verifique se as seguintes depend√™ncias est√£o instaladas:

- **PostgreSQL**: √â necess√°rio ter o **PostgreSQL** instalado e rodando localmente para que o banco de dados seja configurado corretamente.

---

## ‚ñ∂Ô∏è Cria√ß√£o da Chave da API do YouTube

Para utilizar a **YouTube Data API v3**, √© necess√°rio gerar uma chave de API no **Google Cloud Console**.

### Passo a passo

1. **Acesse o Google Cloud Console**  
   - [console.cloud.google.com](https://console.cloud.google.com/)  
   - Crie uma conta caso ainda n√£o possua

2. **Crie um novo projeto**  
   - No painel inicial clique em **Criar Projeto**  
   - Defina um nome e confirme a cria√ß√£o

3. **Ative a API do YouTube**  
   - V√° em **APIs e servi√ßos > Biblioteca**  
   - Pesquise por **YouTube Data API v3**  
   - Clique em **Ativar**

4. **Crie as credenciais da API**  
   - Acesse **APIs e servi√ßos > Credenciais**  
   - Clique em **Criar credenciais > Chave de API**  
   - Copie a chave gerada e guarde em local seguro

üîó Guia completo: [Tutorial](https://suporte.presence.com.br/portal/pt/kb/articles/criando-uma-chave-para-a-api-de-dados-do-youtube)

--- 

## ü§ñ Cria√ß√£o da Chave da API do Groq

Para utilizar um client do Groq, √© necess√°rio gerar uma chave de API no **Console Groq**.

### Passo a passo

1. **Acesse o [Console Groq](https://console.groq.com/keys)**  
   - Fa√ßa login com sua conta Google (crie uma se ainda n√£o possuir).

2. **Crie a chave da API**  
   - Clique em **Create API Key**  
   - Copie a chave gerada e guarde em local seguro.

---

## üìÅ Configura√ß√£o de ambiente

√â necess√°rio um arquivo `.env` na raiz do projeto com a seguinte estrutura: 

```declarative
YOUTUBE_API_KEY="SuaChaveApiYoutube"
LLM_PROVIDER=GROQ
LLM_API_KEY="SuaChaveApiGroq"
LLM_BATCH_SIZE=30
LLM_PROMPT="Voc√™ √© um analista de coment√°rios de lives. Sua tarefa √© classificar cada coment√°rio com dois n√∫meros:

                  - O primeiro n√∫mero representa o sentimento:
                    0 = Negativo
                    1 = Neutro
                    2 = Positivo

                  - O segundo n√∫mero representa o tipo de intera√ß√£o:
                    3 = Pergunta
                    4 = Elogio
                    5 = Cr√≠tica
                    6 = Sugest√£o
                    7 = Meme / Piada
                    8 = Reclama√ß√£o
                    9 = Rea√ß√£o emocional
                    10 = Ofensivo / Preconceituoso

                  Siga estritamente o padr√£o abaixo, n√£o adicione nem remova nenhuma informa√ß√£o:
                  [ID] '<coment√°rio> ‚Üí' <sentimento> <tipo>

                  Exemplo:
                  [0] 'Muito bom!' ‚Üí 2 4

                  N√£o modifique o ID nem o coment√°rio. Apenas classifique.
                  Caso n√£o se encaixe exatamente em nenhuma categoria classifique com a categoria mais pr√≥xima e sempre siga o padr√£o fornecido."
```

---

## üóÑÔ∏è **Configura√ß√£o do Banco de Dados - PostgreSQL**

1. **Crie um banco de dados com o seguinte nome:**

```bash
live-insights
```

2. **Configura√ß√µes do banco de dados:**

- **Usu√°rio (superusu√°rio):** `postgres`
- **Senha:** `postgres`
- **Porta:** 5432

Obs.: essas s√£o as configura√ß√µes definidas no arquivo `src/main/resources/application.yml`

Certifique-se de que o PostgreSQL esteja rodando corretamente em sua m√°quina local para que o backend se conecte ao banco de dados.

---

## üöÄ **Rodando o Projeto no Terminal**

Com as depend√™ncias configuradas, vamos rodar o projeto. Para isso, execute o seguinte comando:

```bash
mvn clean spring-boot:run
```

Obs.: O `clean` √© opcional, mas recomendado caso precise limpar o build e come√ßar de novo.

---

## üîß Acessando a API - Swagger UI
Agora que o BackEnd est√° rodando, voc√™ pode visualizar e testar a API diretamente no Swagger UI!

Acesse em:
http://localhost:8090/swagger-ui.html

## üß© Documenta√ß√£o da Arquitetura 

## üß≠ Vis√£o Geral

O **Live Insights** √© uma aplica√ß√£o backend desenvolvida com **Spring Boot** que permite **an√°lise em tempo real de lives (transmiss√µes ao vivo)**, coletando e processando coment√°rios atrav√©s de integra√ß√µes com **Large Language Models (LLMs)** para an√°lise de sentimentos e insights.

---

## ‚öôÔ∏è Tecnologias Principais

- **Java 17**  
- **Spring Boot 3.4.5**  
- **Spring Security** (autentica√ß√£o baseada em sess√£o)  
- **Spring Data JPA**  
- **PostgreSQL**  
- **Maven**  
- **OpenAPI / Swagger** (documenta√ß√£o de API)  
- **OkHttp** (cliente HTTP)  
- **Jackson** (processamento JSON)

---

## üèóÔ∏è Estrutura do Projeto

### üîß Camada de Configura√ß√£o (`config`)

#### **SecurityConfig**
- Autentica√ß√£o baseada em sess√£o HTTP  
- Prote√ß√£o de endpoints (exceto `/auth/register`, `/auth/login` e documenta√ß√£o Swagger)  
- Encoder de senha com **BCrypt**  
- Configura√ß√£o do **AuthenticationManager** com `DaoAuthenticationProvider`

#### **CorsConfig**
- Configura CORS para permitir requisi√ß√µes dos frontends:
  - `http://localhost:5500`
  - `http://localhost:5501`
  - `http://localhost:3000`
  - `https://localhost:3000`

---

### üéÆ Camada de Controle (`controller`)

#### **AuthController**
- **POST /auth/register:** Cadastro de novos usu√°rios  
- **POST /auth/login:** Login com cria√ß√£o de sess√£o HTTP  

#### **LiveController**
- **GET /lives:** Lista todas as lives do usu√°rio autenticado  
- **POST /lives:** Cria nova live com valida√ß√£o de duplicidade  
- **PUT /lives/{liveId}:** Atualiza t√≠tulo da live  
- **PUT /lives/{liveId}/tag:** Atualiza tag da live  
- **DELETE /lives/{liveId}:** Remove live e limpa tags √≥rf√£s  

> Inclui um `@RestController` interno **TagController** que exp√µe:  
> - **GET /tags:** Lista todas as tags dispon√≠veis

#### **CommentsController**
- **GET /comments/{liveId}:** Retorna coment√°rios de uma live espec√≠fica do usu√°rio autenticado  

#### **LiveAnalysisController**
- **POST /live/start/{liveId}:** Inicia an√°lise de uma live  
- **POST /live/stop:** Interrompe an√°lise em execu√ß√£o  
- **GET /live/status:** Verifica status da an√°lise  

---

### üß± Camada de Modelo (`model`)

#### **Entidades Principais**

**User**
- Representa usu√°rios do sistema  
- Relacionamento **one-to-many** com `Live`

**Live**
- Representa uma transmiss√£o ao vivo  
- Campos: `liveId`, `title`, refer√™ncia para `User` e `Tag`  
- Relacionamento **many-to-one** com `User` e `Tag`

**Tag**
- Categoriza√ß√£o de lives  
- Relacionamento **one-to-many** com `Live`

**CommentsInfo**
- Armazena informa√ß√µes agregadas dos coment√°rios coletados  
- Relacionamento com `Live` e `User`

---

#### **DTOs de API Externa**

- `GeneralInfoData`: Informa√ß√µes gerais sobre a live  
- `CommentsDetails`, `CommentsDetailsData`: Detalhes dos coment√°rios individuais  
- `AuthorDetails`, `AuthorDetailsData`: Informa√ß√µes sobre autores dos coment√°rios  

---

#### **Enums**
- `LiveStatus`: Estados poss√≠veis de uma live  
- `Sentiment`: Classifica√ß√£o de sentimento dos coment√°rios  
- `Interaction`: Tipos de intera√ß√£o do usu√°rio  

---

### üóÉÔ∏è Camada de Reposit√≥rio (`repository`)

Interfaces **Spring Data JPA**:
- `UserRepository`: Busca usu√°rios por username  
- `LiveRepository`: Queries customizadas para lives (por usu√°rio, por liveId, contagem por tag)  
- `TagRepository`: Busca tags por nome (case-insensitive)  
- `CommentsRepository`: Busca coment√°rios por live e usu√°rio  

---

### üß† Camada de Servi√ßo (`service`)

#### **Servi√ßos de LLM**
Interfaces:
- `ILLMService`: Interface base para servi√ßos de LLM  
- `IOpenAiService`, `IGeminiService`, `IGroqService`: Interfaces espec√≠ficas  

Implementa√ß√µes:
- `LLMService`: Classe abstrata base  
- `OpenAiService`: Integra√ß√£o com OpenAI  
- `GeminiService`: Integra√ß√£o com Google Gemini  
- `GroqService`: Integra√ß√£o com Groq  

---

#### **Servi√ßos de An√°lise**
- **LiveAnalysisService (`ILiveAnalysisService`)**: Orquestra o processo completo de an√°lise de lives  
  - Gerencia configura√ß√£o, in√≠cio e parada de an√°lises  
  - Coordena coleta de coment√°rios e processamento via LLM  

- **ScheduledAnalysisTask**: Executa tarefas agendadas de an√°lise, coletando dados periodicamente durante a transmiss√£o  

- **FetchLiveComments**: Respons√°vel pela coleta de coment√°rios da API externa e estrutura√ß√£o dos dados  

- **CheckLiveActivity**: Verifica se uma live est√° ativa/online  

---

#### **Servi√ßos Auxiliares**
- **ConsumeApi (IConvertData):** Cliente HTTP gen√©rico para consumo de APIs externas usando **OkHttp**  
- **ConvertData (IConvertData):** Convers√£o entre JSON e objetos Java usando **Jackson**  
- **UserDetailsServiceImpl:** Implementa√ß√£o customizada de `UserDetailsService` do **Spring Security**  

---

### üßæ DTOs (`dto`)

- `AuthRequest`: Payload para requisi√ß√µes de autentica√ß√£o (login/registro)  
- `ErrorResponse`: Estrutura padronizada de resposta de erro  

---

### üö® Tratamento Global de Exce√ß√µes

**GlobalExceptionHandler (`@ControllerAdvice`)**
- Captura exce√ß√µes n√£o tratadas  
- Retorna respostas HTTP apropriadas com `ErrorResponse`  
- Trata especificamente `EntityNotFoundException` (404)  

---

## ‚öôÔ∏è Configura√ß√£o da Aplica√ß√£o

**application.yml**
- Porta do servidor: `8090`  
- Configura√ß√£o do PostgreSQL (`localhost:5432`)  
- Hibernate DDL: `update`  
- Logs SQL ativados  

**OpenApiConfig**
- Configura documenta√ß√£o **Swagger / OpenAPI**  
- Acess√≠vel via `/swagger-ui.html`  

---

## üîÅ Fluxo de Dados Principal

1. **Autentica√ß√£o:** Usu√°rio se registra ou faz login via `AuthController`  
2. **Cria√ß√£o de Live:** Usu√°rio cria uma live atrav√©s do `LiveController`  
3. **In√≠cio da An√°lise:** `LiveAnalysisController` inicia an√°lise da live  
4. **Coleta de Dados:** `FetchLiveComments` busca coment√°rios periodicamente  
5. **Processamento:** `LiveAnalysisService` envia dados para o LLM escolhido  
6. **Armazenamento:** Resultados s√£o salvos via `CommentsRepository`  
7. **Consulta:** Usu√°rio recupera an√°lises via `CommentsController`  

---

## üß± Padr√µes de Arquitetura

- **MVC / REST:** Separa√ß√£o clara entre Controller, Service e Repository  
- **Dependency Injection:** Uso extensivo de `@Autowired`  
- **Strategy Pattern:** Implementa√ß√µes m√∫ltiplas de LLM services  
- **Repository Pattern:** Abstra√ß√£o de acesso a dados  
- **DTO Pattern:** Separa√ß√£o entre entidades e objetos de transfer√™ncia  

---

## üîê Seguran√ßa

- Autentica√ß√£o baseada em sess√£o HTTP (n√£o JWT)  
- Senhas criptografadas com **BCrypt**  
- **CSRF** desabilitado (comum em APIs REST)  
- Valida√ß√£o de **ownership** (usu√°rio s√≥ acessa suas pr√≥prias lives)  
- CORS configurado para origens espec√≠ficas  

## Stack Tecnol√≥gica
```
Backend Framework: Spring Boot 3.4.5
Linguagem: Java 17
Build Tool: Maven
Banco de Dados: PostgreSQL
ORM: Spring Data JPA (Hibernate)
Seguran√ßa: Spring Security
Cliente HTTP: OkHttp 4.12.0
Serializa√ß√£o JSON: Jackson 2.15.2
Documenta√ß√£o: SpringDoc OpenAPI 2.8.8
Gerenciamento de Vari√°veis: dotenv-java 3.2.0
```

### Vis√£o Geral da Arquitetura

<p align="center">
  <img width="700" alt="image" src="https://github.com/user-attachments/assets/7dad90eb-7f06-4d50-bc61-b1c4ff11442a" />
</p>

---

## Estrutura de Pacotes

```
br.com.wtd.liveinsights
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ CorsConfig              # Configura√ß√£o CORS
‚îÇ   ‚îî‚îÄ‚îÄ SecurityConfig          # Seguran√ßa e autentica√ß√£o
‚îú‚îÄ‚îÄ controller
‚îÇ   ‚îú‚îÄ‚îÄ AuthController          # Registro e login
‚îÇ   ‚îú‚îÄ‚îÄ LiveController          # CRUD de lives e tags
‚îÇ   ‚îú‚îÄ‚îÄ CommentsController      # Consulta de coment√°rios
‚îÇ   ‚îî‚îÄ‚îÄ LiveAnalysisController  # Controle de an√°lise
‚îú‚îÄ‚îÄ dto
‚îÇ   ‚îú‚îÄ‚îÄ AuthRequest
‚îÇ   ‚îî‚îÄ‚îÄ ErrorResponse
‚îú‚îÄ‚îÄ model
‚îÇ   ‚îú‚îÄ‚îÄ User                    # Usu√°rio do sistema
‚îÇ   ‚îú‚îÄ‚îÄ Live                    # Transmiss√£o ao vivo
‚îÇ   ‚îú‚îÄ‚îÄ Tag                     # Categoriza√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ CommentsInfo            # An√°lises armazenadas
‚îÇ   ‚îú‚îÄ‚îÄ Sentiment               # Enum de sentimentos
‚îÇ   ‚îú‚îÄ‚îÄ Interaction             # Enum de intera√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ [DTOs de APIs externas]
‚îú‚îÄ‚îÄ repository
‚îÇ   ‚îú‚îÄ‚îÄ UserRepository
‚îÇ   ‚îú‚îÄ‚îÄ LiveRepository
‚îÇ   ‚îú‚îÄ‚îÄ TagRepository
‚îÇ   ‚îî‚îÄ‚îÄ CommentsRepository
‚îú‚îÄ‚îÄ service
‚îÇ   ‚îú‚îÄ‚îÄ interfaces
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [Interfaces de servi√ßos]
‚îÇ   ‚îú‚îÄ‚îÄ UserDetailsServiceImpl  # Autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ LiveAnalysisService     # Orquestra√ß√£o de an√°lise
‚îÇ   ‚îú‚îÄ‚îÄ ScheduledAnalysisTask   # Coleta peri√≥dica
‚îÇ   ‚îú‚îÄ‚îÄ FetchLiveComments       # Busca coment√°rios
‚îÇ   ‚îú‚îÄ‚îÄ CheckLiveActivity       # Verifica status da live
‚îÇ   ‚îú‚îÄ‚îÄ LLMService              # Classe base para LLMs
‚îÇ   ‚îú‚îÄ‚îÄ OpenAiService           # Integra√ß√£o OpenAI
‚îÇ   ‚îú‚îÄ‚îÄ GeminiService           # Integra√ß√£o Gemini
‚îÇ   ‚îú‚îÄ‚îÄ GroqService             # Integra√ß√£o Groq
‚îÇ   ‚îú‚îÄ‚îÄ ConsumeApi              # Cliente HTTP gen√©rico
‚îÇ   ‚îî‚îÄ‚îÄ ConvertData             # Serializa√ß√£o JSON
‚îú‚îÄ‚îÄ GlobalExceptionHandler      # Tratamento de erros
‚îî‚îÄ‚îÄ OpenApiConfig               # Configura√ß√£o Swagger

---

## Controllers

**AuthController** (`/auth`)
- `POST /register` - Cadastro de usu√°rios
- `POST /login` - Login com cria√ß√£o de sess√£o

**LiveController** (`/lives`)
- `GET /lives` - Lista lives do usu√°rio
- `POST /lives` - Cria nova live (com tag)
- `PUT /lives/{liveId}` - Atualiza t√≠tulo
- `PUT /lives/{liveId}/tag` - Atualiza tag
- `DELETE /lives/{liveId}` - Remove live
- `GET /tags` - Lista todas as tags (nested controller)

**CommentsController** (`/comments`)
- `GET /comments/{liveId}` - Retorna an√°lises da live

**LiveAnalysisController** (`/live`)
- `POST /live/start/{liveId}` - Inicia an√°lise
- `POST /live/stop` - Para an√°lise
- `GET /live/status` - Status atual

---

## Services

**Autentica√ß√£o:**
- **UserDetailsServiceImpl**: Carrega dados do usu√°rio para Spring Security

**An√°lise de Lives:**
- **LiveAnalysisService**: Orquestra todo processo de an√°lise
- **ScheduledAnalysisTask**: Executa coleta peri√≥dica (a cada 5 min)
- **FetchLiveComments**: Busca coment√°rios da API externa
- **CheckLiveActivity**: Verifica se live est√° ativa

**Integra√ß√£o com LLMs:**
- **LLMService** (abstrata): Classe base com l√≥gica comum
- **OpenAiService**: Integra√ß√£o com GPT-4
- **GeminiService**: Integra√ß√£o com Gemini Pro
- **GroqService**: Integra√ß√£o com Llama2/Mixtral

**Utilit√°rios:**
- **ConsumeApi**: Cliente HTTP com OkHttp
- **ConvertData**: Serializa√ß√£o JSON com Jackson
